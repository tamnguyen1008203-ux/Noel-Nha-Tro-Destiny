<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Merry Christmas - Nh√† Tr·ªç Destiny</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --primary-red: #b32626; --vintage-cream: #f4eee1; --gold: #c5a059; --noel-red: #d42426; }
        body { margin: 0; height: 100dvh; display: flex; justify-content: center; align-items: center; background: #0b1a2a url('https://images.unsplash.com/photo-1543589077-47d81606c1bf?q=80&w=2070') no-repeat center center/cover; overflow: hidden; font-family: 'Quicksand', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        #main-content { opacity: 0; transition: opacity 0.5s; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        #scratch-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; touch-action: none; transition: opacity 0.8s; }
        #scratch-canvas { width: 100%; height: 100%; cursor: crosshair; }

        .envelope-wrapper { position: relative; width: 320px; height: 210px; z-index: 10; transition: 0.8s; }
        .envelope-container { position: absolute; width: 100%; height: 100%; background: var(--vintage-cream); border-radius: 0 0 10px 10px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); }
        .lid { position: absolute; top: 0; left: 0; border-left: 160px solid transparent; border-right: 160px solid transparent; border-top: 120px solid var(--primary-red); transform-origin: top; transition: transform 0.8s; z-index: 20; }
        .bow { position: absolute; top: 90px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; background: var(--noel-red); border-radius: 50%; z-index: 40; display: flex; justify-content: center; align-items: center; color: white; font-size: 10px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 2px solid white; cursor: pointer; }
        
        .open-state .lid { transform: rotateX(180deg); }
        .open-state .envelope-wrapper { transform: translateY(100vh); opacity: 0; pointer-events: none; }

        .letter { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 90%; max-width: 380px; background: var(--vintage-cream); padding: 25px; border: 8px double var(--gold); border-radius: 5px; z-index: 100; opacity: 0; transition: all 0.4s ease; text-align: center; box-sizing: border-box; }
        .open-state .letter { transform: translate(-50%, -50%) scale(1); opacity: 1; }

        #movie-frame {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            width: 100%; opacity: 0; pointer-events: none; z-index: 200; transition: opacity 1s;
        }

        .movie-text { color: #ffffff; font-family: 'Dancing Script', cursive; font-size: 2.2rem; text-shadow: 2px 2px 8px #ff0000; font-weight: bold; text-align: center; width: 100%; opacity: 0; transition: 1s; }

        #memory-rail { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 15px; 
            justify-items: center; 
            align-items: center; 
            width: 95%;
            max-width: 450px;
        }

        .memory-img { 
            width: 28vw; 
            max-width: 120px; 
            aspect-ratio: 1/1; 
            object-fit: cover;
            border: 2px solid white; 
            border-radius: 6px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
            opacity: 0;
            transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .show-memories #movie-frame { opacity: 1; pointer-events: auto; }
        .show-memories .memory-img, .show-memories .movie-text { opacity: 1; transform: translate(0, 0); }

        @keyframes movieLoop {
            0%, 100% { transform: scale(1); z-index: 10; }
            50% { transform: scale(1.3); z-index: 300; box-shadow: 0 15px 30px rgba(0,0,0,0.8); }
        }
        .slideshow-active .memory-img { animation: movieLoop 4s infinite ease-in-out; }
        .memory-img:nth-child(1) { animation-delay: 0s; }
        .memory-img:nth-child(2) { animation-delay: 0.6s; }
        .memory-img:nth-child(3) { animation-delay: 1.2s; }
        .memory-img:nth-child(4) { animation-delay: 1.8s; }
        .memory-img:nth-child(5) { animation-delay: 2.4s; }
        .memory-img:nth-child(6) { animation-delay: 3s; }

        /* KHUNG VIDEO */
        #video-container {
            position: fixed; inset: 0; background: black; z-index: 500;
            display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 1s;
        }
        #video-player { width: 100%; max-height: 100%; outline: none; }

        /* SANTA */
        #santa-ride {
            position: fixed; top: 15%; left: -300px; font-size: 50px; z-index: 400;
            white-space: nowrap; pointer-events: none; opacity: 0;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }
        @keyframes santaFly {
            0% { left: -300px; transform: translateY(0) rotate(5deg); }
            25% { transform: translateY(-30px) rotate(-5deg); }
            50% { transform: translateY(0) rotate(5deg); }
            75% { transform: translateY(-30px) rotate(-5deg); }
            100% { left: 110vw; transform: translateY(0) rotate(5deg); }
        }
        .fly-santa #santa-ride { opacity: 1; animation: santaFly 12s linear infinite; }

        #fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        .snow { position: fixed; top: -10px; background: white; border-radius: 50%; pointer-events: none; animation: fall linear infinite; z-index: 99; }
        @keyframes fall { to { transform: translateY(100vh); } }
    </style>
</head>
<body>

    <div id="scratch-container"><canvas id="scratch-canvas"></canvas></div>

    <div id="main-content">
        <audio id="scratchSound" loop><source src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
        <audio id="bgMusic"><source src="music.mp3"></audio>
        <audio id="bgMusic1"><source src="music1.mp3"></audio>
        <audio id="clickSound"><source src="https://www.fesliyanstudios.com/play-mp3/387"></audio>

        <div id="movie-frame">
            <div class="movie-text">Cung h·ª∑ Christmas</div>
            <div id="memory-rail">
                <img src="merry1.png" class="memory-img">
                <img src="merry3.png" class="memory-img">
                <img src="merry4.png" class="memory-img">
                <img src="merry6.png" class="memory-img">
                <img src="merry5.png" class="memory-img">
                <img src="merry2.png" class="memory-img">
            </div>
            <div class="movie-text">Merry ph√°t t√†i</div>
        </div>

        <div id="video-container">
            <video id="video-player" playsinline webkit-playsinline></video>
        </div>

        <div id="santa-ride">üéÖüõ∑ü¶åü¶å</div>

        <div class="envelope-wrapper">
            <div class="lid"></div>
            <div class="envelope-container">
                <div class="bow" onclick="openLetter()">OPEN</div>
                <div style="position:absolute;bottom:20px;width:100%;text-align:center;color:var(--primary-red);font-family:'Dancing Script';font-size:1.8rem;">Nh√† Tr·ªç Destiny</div>
            </div>
        </div>

        <div class="letter" id="letter">
            <div style="font-family:'Dancing Script';color:var(--primary-red);font-size:1.8rem;border-bottom:2px solid var(--gold);margin-bottom:10px;">Merry Christmas</div>
            <div id="typewriter" style="font-size:0.9rem;line-height:1.5;color:#3e2723;"></div>
            <p id="closing-text" style="font-family:'Dancing Script';font-size:1.4rem;color:var(--primary-red);margin-top:10px;opacity:0;">Hihi, love you all!!</p>
        </div>
        <canvas id="fireworks"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        const sfx = document.getElementById('scratchSound');
        const bgMusic = document.getElementById('bgMusic');
        const bgMusic1 = document.getElementById('bgMusic1');
        const videoContainer = document.getElementById('video-container');
        const videoPlayer = document.getElementById('video-player');
        let isDrawing = false;

        // DANH S√ÅCH 2 VIDEO
        const playlist = ["video1.mp4", "video2.mp4"];
        let currentVideoIdx = 0;

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.fillStyle = '#d42426';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.font = 'bold 26px "Dancing Script"';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText('C√†o ƒë·ªÉ nh·∫≠n qu√† t·ª´ David!', canvas.width/2, canvas.height/2);
            document.getElementById('main-content').style.opacity = '1';
        }

        function scratch(e) {
            if (!isDrawing) return;
            sfx.play().catch(()=>{});
            const x = (e.clientX || (e.touches ? e.touches[0].clientX : 0));
            const y = (e.clientY || (e.touches ? e.touches[0].clientY : 0));
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 45, 0, Math.PI*2);
            ctx.fill();
            check();
        }

        function check() {
            const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
            let count = 0;
            for(let i=3; i<data.length; i+=4) if(data[i] === 0) count++;
            if(count > (data.length/4) * 0.45) {
                document.getElementById('scratch-container').style.opacity = '0';
                setTimeout(() => {
                    const el = document.getElementById('scratch-container');
                    if(el) el.remove();
                }, 800);
            }
        }

        canvas.addEventListener('mousedown', () => isDrawing = true);
        window.addEventListener('mouseup', () => { isDrawing = false; sfx.pause(); });
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchend', () => { isDrawing = false; sfx.pause(); });
        canvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); }, {passive: false});
        window.onload = init;

        function openLetter() {
            document.body.classList.add('open-state');
            document.getElementById('clickSound').play();
            bgMusic.volume = 1.0;
            bgMusic1.volume = 1.0;
            bgMusic.play();
            bgMusic.onended = () => bgMusic1.play();
            bgMusic1.onended = () => bgMusic.play();
            setTimeout(type, 1200);
        }

        const msg = "L·ªùi ƒë·∫ßu ti√™n, xin ch√∫c cho nh√† tr·ªç Destiny ch√∫ng ta m·ªôt m√πa gi√°ng sinh an l√†nh. Ch√∫c cho m·ªçi ng∆∞·ªùi lu√¥n lu√¥n h·∫°nh ph√∫c, c√¥ng vi·ªác s·∫Ω ng√†y c√†ng ph√°t tri·ªÉn, thu·∫≠n l·ª£i h∆°n. Ai ch∆∞a c√≥ b·ªì th√¨ s·∫Ω c√≥ b·ªì ngay sau gi√°ng sinh, ai c√≥ r·ªìi th√¨ s·∫Ω y√™u nhau th·∫≠t l√¢u. Cu·ªëi c√πng, ch√∫c cho ch√∫ng ta s·∫Ω c√≥ th·ªÉ gi·ªØ ƒë∆∞·ª£c m·ªëi quan h·ªá th√¢n thi·∫øt nh∆∞ b√¢y gi·ªù v√† v·ªÅ sau n√†y (n·∫øu ƒë∆∞·ª£c).";
        let idx = 0;
        function type() {
            if (idx < msg.length) {
                document.getElementById("typewriter").innerHTML += msg.charAt(idx);
                idx++;
                setTimeout(type, 45);
            } else {
                document.getElementById("closing-text").style.opacity = "1";
                setTimeout(startMovie, 300);
            }
        }

        function startMovie() {
            document.getElementById('letter').style.opacity = '0';
            document.getElementById('letter').style.transform = 'translate(-50%, -50%) scale(0)';
            document.body.classList.add('show-memories');
            
            setTimeout(() => {
                document.querySelectorAll('.memory-img').forEach(img => img.classList.add('slideshow-active'));
                document.body.classList.add('fly-santa'); 
                startF();

                // CH·ªú 7 GI√ÇY R·ªíI PH√ÅT 2 VIDEO
                setTimeout(startPlaylist, 7000);
            }, 1200);
        }

        function startPlaylist() {
            bgMusic.volume = 0.2;
            bgMusic1.volume = 0.2;
            videoContainer.style.display = 'flex';
            setTimeout(() => {
                videoContainer.style.opacity = '1';
                playNextVideo();
            }, 100);
        }

        function playNextVideo() {
            if (currentVideoIdx < playlist.length) {
                videoPlayer.src = playlist[currentVideoIdx];
                videoPlayer.play().catch(e => console.log("Video play error:", e));
                videoPlayer.onended = () => {
                    currentVideoIdx++;
                    playNextVideo();
                };
            } else {
                videoContainer.style.opacity = '0';
                setTimeout(() => {
                    videoContainer.style.display = 'none';
                    bgMusic.volume = 1.0;
                    bgMusic1.volume = 1.0;
                }, 1000);
            }
        }

        const cF = document.getElementById('fireworks'); const xF = cF.getContext('2d'); let pS = [];
        function startF() { cF.width = window.innerWidth; cF.height = window.innerHeight; anim(); setInterval(() => { createP(Math.random() * cF.width, Math.random() * cF.height * 0.5); }, 800); }
        function createP(x, y) { const cls = ['#ff0000', '#ffd700', '#ffffff']; for (let i = 0; i < 40; i++) pS.push({ x, y, dx: (Math.random()-0.5)*7, dy: (Math.random()-0.5)*7, size: Math.random()*2, color: cls[Math.floor(Math.random()*3)], life: 100 }); }
        function anim() { xF.clearRect(0, 0, cF.width, cF.height); pS.forEach((p, idx) => { p.x += p.dx; p.y += p.dy; p.dy += 0.05; p.life -= 2; xF.fillStyle = p.color; xF.beginPath(); xF.arc(p.x, p.y, p.size, 0, Math.PI*2); xF.fill(); if (p.life <= 0) pS.splice(idx, 1); }); requestAnimationFrame(anim); }
        setInterval(() => { const s = document.createElement('div'); s.className = 'snow'; s.style.left = Math.random() * 100 + 'vw'; const sz = Math.random()*4+2+'px'; s.style.width = sz; s.style.height = sz; s.style.animationDuration = Math.random()*3+2+'s'; document.body.appendChild(s); setTimeout(() => s.remove(), 5000); }, 150);
    </script>
</body>
</html>